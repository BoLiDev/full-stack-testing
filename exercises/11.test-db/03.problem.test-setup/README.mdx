# Test Setup

👨‍💼 Alright, now we want this to work for more than just the github auth test, so
we're going to want to move this over to the `tests/setup/` directory. But
before we do you need to remember that our test files all run in parallel. This
will cause problems if they're using the same test database because they'll
conflict when they try to delete users between tests and even the entire test
database when they're done!

So we need to make sure each test gets its own test database. Luckily, Vitest
gives us a special environment variable to uniquely identify each test process
called `VITEST_POOL_ID` which is an incrementing number. So we can update our
`databaseFile` to include that in the database filename to keep them from
colliding.

So go ahead and update that, then move
the <InlineFile file="app/routes/_auth+/__setup.ts" /> file to
`tests/setup/db-setup.ts`.

Now you can run all the tests at once. If you watch carefully, you should be
able to notice the test databases being created and deleted.

```sh nonumber
npx vitest
```
